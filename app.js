const YOUTUBE_LINKS = {
	end : "https://youtube.com/embed/hgnA7sHq3AE",
	confession__volume_on__dance_off__aaron_on__partner_none__script_basic: "https://youtube.com/embed/XbMfYDIIAu4",
    confession__volume_off__dance_off__aaron_on__partner_none__script_basic: "https://youtube.com/embed/VfE_PpGTzN8",
    confession__volume_on__dance_off__aaron_on__partner_none__script_standard: "https://youtube.com/embed/6rMPIUNxO0g",
    confession__volume_off__dance_off__aaron_on__partner_none__script_standard: "https://youtube.com/embed/1i1hsQDXcgc",
    confession__volume_on__dance_off__aaron_on__partner_none__script_eloquent: "https://youtube.com/embed/WhKRQ0kn5K8",
    confession__volume_off__dance_off__aaron_on__partner_none__script_eloquent: "https://youtube.com/embed/bIILCwpSeMQ",
    confession__volume_on__dance_on__aaron_on__partner_none__script_basic: "https://youtube.com/embed/scZoE0qOcyc",
    confession__volume_off__dance_on__aaron_on__partner_none__script_basic: "https://youtube.com/embed/F0YfAw_RwtQ",
    confession__volume_on__dance_on__aaron_on__partner_none__script_standard: "https://youtube.com/embed/54U18aLIBNE",
    confession__volume_off__dance_on__aaron_on__partner_none__script_standard: "https://youtube.com/embed/OH_AKRywETo",
    confession__volume_on__dance_on__aaron_on__partner_none__script_eloquent: "https://youtube.com/embed/hgHOwMUY818",
    confession__volume_off__dance_on__aaron_on__partner_none__script_eloquent: "https://youtube.com/embed/fQT2mtkXJJ0",
    confession__volume_on__dance_off__aaron_on__partner_zara__script_basic: "https://youtube.com/embed/gB-DmRQWDII",
    confession__volume_off__dance_off__aaron_on__partner_zara__script_basic: "https://youtube.com/embed/U0cIx6Lcfmk",
    confession__volume_on__dance_off__aaron_on__partner_zara__script_standard: "https://youtube.com/embed/rmAatBHnkVU",
    confession__volume_off__dance_off__aaron_on__partner_zara__script_standard: "https://youtube.com/embed/-b0caf2YSSk",
    confession__volume_on__dance_off__aaron_on__partner_zara__script_eloquent: "https://youtube.com/embed/UD2IPfWAVt4",
    confession__volume_off__dance_off__aaron_on__partner_zara__script_eloquent: "https://youtube.com/embed/fZPdxB-SRbQ",
    confession__volume_on__dance_on__aaron_on__partner_zara__script_basic: "https://youtube.com/embed/HXa8SMc8Xl8",
    confession__volume_off__dance_on__aaron_on__partner_zara__script_basic: "https://youtube.com/embed/m6f_YsmC2GA",
    confession__volume_on__dance_on__aaron_on__partner_zara__script_standard: "https://youtube.com/embed/EUbNGduU_xg",
    confession__volume_off__dance_on__aaron_on__partner_zara__script_standard: "https://youtube.com/embed/X04Izg30fhk",
	confession__volume_on__dance_on__aaron_off__partner_zara__script_basic: "https://youtube.com/embed/PEWmXK9du0g",
    confession__volume_off__dance_on__aaron_off__partner_zara__script_basic: "https://youtube.com/embed/1US2a2S2EMw",
    confession__volume_on__dance_off__aaron_off__partner_zara__script_basic: "https://youtube.com/embed/CTdmYwJCGgA",
    confession__volume_off__dance_off__aaron_off__partner_zara__script_basic: "https://youtube.com/embed/43ky419-BPQ",
    confession__volume_on__dance_off__aaron_on__partner_betty__script_basic: "https://youtube.com/embed/BFVksgGKb5U",
    confession__volume_off__dance_off__aaron_on__partner_betty__script_basic: "https://youtube.com/embed/gb5JKwzJoIA",
    confession__volume_on__dance_off__aaron_on__partner_betty__script_standard: "https://youtube.com/embed/dArN6Solcu4",
    confession__volume_off__dance_off__aaron_on__partner_betty__script_standard: "https://youtube.com/embed/AYF6d_Eoi98",
    confession__volume_on__dance_on__aaron_on__partner_betty__script_basic: "https://youtube.com/embed/CAfn0XUPnhY",
    confession__volume_off__dance_on__aaron_on__partner_betty__script_basic: "https://youtube.com/embed/cJy02cS5Ltw",
    confession__volume_on__dance_on__aaron_on__partner_betty__script_standard: "https://youtube.com/embed/82z6XTOoV1Q",
    confession__volume_off__dance_on__aaron_on__partner_betty__script_standard: "https://youtube.com/embed/eDTJkjoqYds",
    confession__volume_on__dance_off__aaron_off__partner_none__script_basic: "https://youtube.com/embed/8do6bGCNMmM",
    confession__volume_off__dance_off__aaron_off__partner_none__script_basic: "https:/youtube.com/embed/ABN-fJOZeJA",
	confession__volume_on__dance_off__aaron_off__partner_none__script_standard: "https://youtube.com/embed/8do6bGCNMmM",
    confession__volume_off__dance_off__aaron_off__partner_none__script_standard: "https:/youtube.com/embed/ABN-fJOZeJA",
	confession__volume_on__dance_off__aaron_off__partner_none__script_eloquent: "https://youtube.com/embed/8do6bGCNMmM",
    confession__volume_off__dance_off__aaron_off__partner_none__script_eloquent: "https:/youtube.com/embed/ABN-fJOZeJA",
    confession__volume_on__dance_on__aaron_off__partner_betty__script_basic: "https://youtube.com/embed/VYMAfzcmEh8",
    confession__volume_off__dance_on__aaron_off__partner_betty__script_basic: "https://youtube.com/embed/f175lI_-WzM",
    confession__volume_on__dance_off__aaron_off__partner_betty__script_basic: "https://youtube.com/embed/fCsqUQ9GFek",
    confession__volume_off__dance_off__aaron_off__partner_betty__script_basic: "https://youtube.com/embed/GXxRMK1OsPs",
    confession__volume_on__dance_off__aaron_on__partner_gary__script_basic: "https://youtube.com/embed/jam3KdeEZ9I",
    confession__volume_off__dance_off__aaron_on__partner_gary__script_basic: "https://youtube.com/embed/iraOwR7UQHg",
    confession__volume_on__dance_off__aaron_on__partner_gary__script_standard: "https://youtube.com/embed/KEE-WkgnwjQ",
    confession__volume_off__dance_off__aaron_on__partner_gary__script_standard: "https://youtube.com/embed/yItXsXrV0MA",
    confession__volume_on__dance_on__aaron_on__partner_gary__script_basic: "https://youtube.com/embed/gSKqwWFf7hQ",
    confession__volume_off__dance_on__aaron_on__partner_gary__script_basic: "https://youtube.com/embed/0D3LivwW-tk",
    confession__volume_on__dance_on__aaron_on__partner_gary__script_standard: "https://youtube.com/embed/VE7F4CQEmCI",
    confession__volume_off__dance_on__aaron_on__partner_gary__script_standard: "https://youtube.com/embed/2T34SMb1rBs",
    confession__volume_on__dance_on__aaron_off__partner_gary__script_basic: "https://youtube.com/embed/VKNOhB1Fg2I",
    confession__volume_off__dance_on__aaron_off__partner_gary__script_basic: "https://youtube.com/embed/oeW7juREQAs",
    confession__volume_on__dance_off__aaron_off__partner_gary__script_basic: "https://youtube.com/embed/90nkgY0Opao",
    confession__volume_off__dance_off__aaron_off__partner_gary__script_basic: "https://youtube.com/embed/rLvjPA3f7mg",
    proposal__volume_off__dance_off__aaron_off__partner_gary__chocolate_off__champagne_off: "https://youtube.com/embed/K2DxSxzQpq4",
    proposal__volume_off__dance_off__aaron_off__partner_betty__chocolate_off__champagne_off: "https://youtube.com/embed/Rk93oYQNvV4",
	proposal__volume_on__dance_off__aaron_off__partner_betty__chocolate_off__champagne_off: "https://youtube.com/embed/W73_k60XBsQ",
	proposal__volume_on__dance_off__aaron_off__partner_none__chocolate_off__champagne_off: "https://youtube.com/embed/oGs0qtEIFkM",
    proposal__volume_off__dance_off__aaron_off__partner_none__chocolate_off__champagne_off: "https://youtube.com/embed/YCLKj3jKi5A",
    proposal__volume_on__dance_on__aaron_off__partner_none__chocolate_off__champagne_off: "https://youtube.com/embed/n5pnt7hd5Pk",
    proposal__volume_off__dance_on__aaron_off__partner_none__chocolate_off__champagne_off: "https://youtube.com/embed/FjMgMPdLDqA",
    proposal__volume_on__dance_off__aaron_on__partner_none__chocolate_off__champagne_off: "https://youtube.com/embed/DJN2JkVGMBs",
    proposal__volume_off__dance_off__aaron_on__partner_none__chocolate_off__champagne_off: "https://youtube.com/embed/MWgjRBAMnJE",
	proposal__volume_on__dance_on__aaron_on__partner_none__chocolate_off__champagne_off: "https://youtube.com/embed/30vCKBRGbgQ",
    proposal__volume_off__dance_on__aaron_on__partner_none__chocolate_off__champagne_off: "https://youtube.com/embed/akHDVCiiFvk",
	proposal__volume_on__dance_off__aaron_on__partner_none__chocolate_on__champagne_off: "https://youtube.com/embed/nyRFCUIT0cA",
    proposal__volume_off__dance_off__aaron_on__partner_none__chocolate_on__champagne_off: "https://youtube.com/embed/H7PiPr5QoZc",
	proposal__volume_on__dance_on__aaron_on__partner_none__chocolate_on__champagne_off: "https://youtube.com/embed/NNtxcjpBLz4",
    proposal__volume_off__dance_on__aaron_on__partner_none__chocolate_on__champagne_off: "https://youtube.com/embed/NKraROqwV-8",
    proposal__volume_on__dance_off__aaron_on__partner_none__chocolate_off__champagne_on: "https://youtube.com/embed/XRUpbYPAXDU",
    proposal__volume_off__dance_off__aaron_on__partner_none__chocolate_off__champagne_on: "https://youtube.com/embed/tR6-v0d8V8Q",
	proposal__volume_on__dance_on__aaron_on__partner_none__chocolate_off__champagne_on: "https://youtube.com/embed/BQY1SYqBgXQ",
    proposal__volume_off__dance_on__aaron_on__partner_none__chocolate_off__champagne_on: "Ahttps://youtube.com/embed/HBjIS4YWcUk",
	proposal__volume_on__dance_off__aaron_on__partner_none__chocolate_on__champagne_on: "https://youtube.com/embed/rVKb0GIfO1k",
    proposal__volume_off__dance_off__aaron_on__partner_none__chocolate_on__champagne_on: "https://youtube.com/embed/a9tG-3XWlFQ",
	proposal__volume_on__dance_on__aaron_on__partner_none__chocolate_on__champagne_on: "https://youtube.com/embed/tjG5MioPfeo",
    proposal__volume_off__dance_on__aaron_on__partner_none__chocolate_on__champagne_on: "https://youtube.com/embed/io92GWOnNPQ",
	proposal__volume_on__dance_off__aaron_on__partner_zara__chocolate_off__champagne_off: "https://youtube.com/embed/HxesARp7pvU",
    proposal__volume_off__dance_off__aaron_on__partner_zara__chocolate_off__champagne_off: "https://youtube.com/embed/MkPZTEvbpMM",
	proposal__volume_on__dance_off__aaron_on__partner_zara__chocolate_on__champagne_off: "https://youtube.com/embed/6IdV5kBxiiA",
    proposal__volume_off__dance_off__aaron_on__partner_zara__chocolate_on__champagne_off: "https://youtube.com/embed/KhQmZphrvsI",
	proposal__volume_on__dance_off__aaron_on__partner_zara__chocolate_off__champagne_on: "https://youtube.com/embed/mWW987-RSWE",
    proposal__volume_off__dance_off__aaron_on__partner_zara__chocolate_off__champagne_on: "https://youtube.com/embed/-WWlv9l0juQ",
	proposal__volume_on__dance_off__aaron_on__partner_zara__chocolate_on__champagne_on: "https://youtube.com/embed/gF4mSM67wXI",
    proposal__volume_off__dance_off__aaron_on__partner_zara__chocolate_on__champagne_on: "https://youtube.com/embed/DRaSikqgtsE",
	proposal__volume_on__dance_on__aaron_on__partner_zara__chocolate_off__champagne_off: "https://youtube.com/embed/-RJGl6jrbFI",
    proposal__volume_off__dance_on__aaron_on__partner_zara__chocolate_off__champagne_off: "https://youtube.com/embed/xl0PhCZBwrw",
	proposal__volume_on__dance_on__aaron_on__partner_zara__chocolate_on__champagne_off: "https://youtube.com/embed/hjb_Do_Wjsc",
    proposal__volume_off__dance_on__aaron_on__partner_zara__chocolate_on__champagne_off: "https://youtube.com/embed/Xb3aFFAri_U",
	proposal__volume_on__dance_on__aaron_on__partner_zara__chocolate_off__champagne_on: "https://youtube.com/embed/8GkTlIBV-u8",
    proposal__volume_off__dance_on__aaron_on__partner_zara__chocolate_off__champagne_on: "https://youtube.com/embed/KJrQjpqH8Io",
	proposal__volume_on__dance_on__aaron_on__partner_zara__chocolate_on__champagne_on: "https://youtube.com/embed/-o5T8aDTgqQ",
    proposal__volume_off__dance_on__aaron_on__partner_zara__chocolate_on__champagne_on: "https://youtube.com/embed/qUhZOA0SSl0",
	proposal__volume_on__dance_off__aaron_off__partner_zara__chocolate_off__champagne_off: "https://youtube.com/embed/c6b9AxnCRn4",
    proposal__volume_off__dance_off__aaron_off__partner_zara__chocolate_off__champagne_off: "https://youtube.com/embed/3Hux1K7UQ24",
	proposal__volume_on__dance_on__aaron_off__partner_zara__chocolate_off__champagne_off: "https://youtube.com/embed/ndVql3v2ZaE",
    proposal__volume_off__dance_on__aaron_off__partner_zara__chocolate_off__champagne_off: "https://youtube.com/embed/GXeR_d455B4",
	proposal__volume_on__dance_on__aaron_off__partner_zara__chocolate_on__champagne_off: "https://youtube.com/embed/dPlz32vRZtg",
    proposal__volume_off__dance_on__aaron_off__partner_zara__chocolate_on__champagne_off: "https://youtube.com/embed/W-BLFu6dFE0",
	proposal__volume_on__dance_on__aaron_off__partner_zara__chocolate_off__champagne_on: "https://youtube.com/embed/Maa2_TkzEjY",
    proposal__volume_off__dance_on__aaron_off__partner_zara__chocolate_off__champagne_on: "https://youtube.com/embed/Mg5ak-6vRI0",
	proposal__volume_on__dance_on__aaron_off__partner_zara__chocolate_on__champagne_on: "https://youtube.com/embed/4y2WkmenwT4",
    proposal__volume_off__dance_on__aaron_off__partner_zara__chocolate_on__champagne_on: "https://youtube.com/embed/L0FzyEldUQw",
}

let vidCounter = 0;

let state = {
	aaron: {
		value: "on",
		credits: 2,
	},
	partner: {
		value: "none",
		credits: 0,
	},
	volume: {
		value: "on",
		credits: 1,
	},
	dance: {
		value: "off",
		credits: 0,
	},
	story: {
		value: "confession",
		credits: 0,
	},
	confession_script: {
		value: "basic",
		credits: 0,
	},
	prop_chocolate: {
		value: "off",
		credits: 0,
	},
	prop_champagne: {
		value: "off",
		credits: 0,
	},
}

const MAX_CREDITS = 12;
let fontSize = 100;
let aaronInput;
let noActorInput;
let zaraInput;
let bettyInput;
let garyInput;
let confessionInput;
let proposalInput;
let volumeInput;
let danceInput;
let basicInput;
let standardInput;
let eloquentInput;
let chocolateInput;
let champagneInput;
let inputs;
let submitButton;
let proposalContainer;
let confessionContainer;
let webpage;
let proposeRow;
let ending;


let creditBalance;

function main() {
	webpage = document.querySelector('html');
	proposeRow = document.getElementById('proposeRow');
	endingRow = document.getElementById('ending_ctr');

	aaronInput = document.getElementById('aaron')
	noActorInput = document.getElementById('actorNone')
	zaraInput = document.getElementById('actorZara')
	bettyInput = document.getElementById('actorBetty')
	garyInput = document.getElementById('actorGary')
	confessionInput = document.getElementById('storyConfess')
	proposalInput = document.getElementById('storyProposal')
	volumeInput = document.getElementById('volume')
	danceInput = document.getElementById('dance')
	basicInput = document.getElementById('scriptBasic')
	standardInput = document.getElementById('scriptStandard')
	eloquentInput = document.getElementById('scriptEloquent')
	chocolateInput = document.getElementById('propChoc')
	champagneInput = document.getElementById('propChamp')
	inputs = document.querySelectorAll('input')
	creditBalance = document.getElementById("creditBalance")
	submitButton = document.getElementById("submit")
	proposalContainer = document.getElementById("proposalContainer")
	confessionContainer = document.getElementById("confessionContainer")
	vidFrame = document.getElementById('youtube')
	lockIcon = document.getElementById('lock')
	inputs.forEach(function (el) {
		el.addEventListener('click', handleInput);
	})
	submitButton.addEventListener('click', handleInput)
	aaronInput.addEventListener('click', handleInput);
	volumeInput.addEventListener('click', handleInput);
	danceInput.addEventListener('click', handleInput);
	endingRow.addEventListener('click', handleInput);
	window.onresize = resizeHandler;
	resizeHandler();
}

function handleSubmit(inputDiv){
	if (inputDiv.id === "submit"){
		let additionals;
		if (state.story.value === "confession"){
			additionals = `script_${state.confession_script.value}`;
		}
		else {
			additionals = `chocolate_${state.prop_chocolate.value}__champagne_${state.prop_champagne.value}`;
		}
		let targetVid = `${state.story.value}__volume_${state.volume.value}__dance_${state.dance.value}__aaron_${state.aaron.value}__partner_${state.partner.value}__${additionals}`
		vidFrame.src = YOUTUBE_LINKS[targetVid];
		vidFrame.classList.remove('invisible')
		lockIcon.classList.add('vidActive')
		submitButton.classList.add('scaleDown')
		setTimeout(function(){
			submitButton.classList.remove('scaleDown')
		}, 150)

		vidCounter++;
		if (vidCounter >= 5){
			proposeRow.classList.remove('inactive')
		}
		if (vidCounter >= 15){
			endingRow.classList.remove('invisible')
		}
	}
	else {
		let targetVid = 'end';
		vidFrame.src = YOUTUBE_LINKS[targetVid];
		endingRow.children[0].classList.add('scaleDown')
		setTimeout(function(){
			endingRow.children[0].classList.remove('scaleDown')
		}, 150)
	}
	
}


function handleInput() {
	console.log('ding!')
	if (this.id === "submit" || this.id === "ending_ctr") {
		handleSubmit(this)
	} else {
		handleOption(this)
	}
}

function handleOption(node) {
	
	let inputType = state[node.dataset.state];
	if (node.checked === false) {
		inputType.value = "off";
		inputType.credits = 0;
	}
	else if (node.dataset.state === "aaron"){
		if (inputType.value === "off"){
			inputType.value = "on"
			inputType.credits = 2;
			aaronInput.classList.remove('off')
		} else {
			inputType.value = "off"
			inputType.credits = 0;
			aaronInput.classList.add('off')
		}
	}
	else if (node.dataset.state === "volume"){
		if (inputType.value === "off"){
			inputType.value = "on"
			inputType.credits = 1;
			volumeInput.classList.add('active')
		} else {
			inputType.value = "off"
			inputType.credits = 0;
			volumeInput.classList.remove('active')
		}
		volumeInput.classList.add('scaleDown')
		setTimeout(function(){
			volumeInput.classList.remove('scaleDown')
		}, 150)
	}
	else if (node.dataset.state === "dance"){
		if (inputType.value === "off"){
			inputType.value = "on"
			inputType.credits = 2;
			danceInput.classList.add('active')
		} else {
			inputType.value = "off"
			inputType.credits = 0;
			danceInput.classList.remove('active')
		}
		danceInput.classList.add('scaleDown')
		setTimeout(function(){
			danceInput.classList.remove('scaleDown')
		}, 150)
	}
	else {
		inputType.value = node.value;
		inputType.credits = parseInt(node.dataset.credits);
	}

	creditBalance.textContent = MAX_CREDITS - sumCredits();
	if (sumCredits() > MAX_CREDITS) {
		creditBalance.classList.add('error');
		submitButton.classList.add('error');
	} else {
		creditBalance.classList.remove('error')
		submitButton.classList.remove('error')
	}

	if (state.story.value === "confession") {
		proposalContainer.classList.add('invisible');
		confessionContainer.classList.remove('invisible');
	} else if (state.story.value === "proposal" && state.aaron.value === "on" && state.partner.value !== "none"){
		proposalContainer.classList.remove('invisible');
		confessionContainer.classList.add('invisible');
	} else {
		proposalContainer.classList.add('invisible');
		confessionContainer.classList.add('invisible');
	}

	let additionals;
	if (state.story.value === "confession"){
		additionals = `script_${state.confession_script.value}`;
	}
	else {
		additionals = `chocolate_${state.prop_chocolate.value}__champagne_${state.prop_champagne.value}`;
	}
	let targetVid = `${state.story.value}__volume_${state.volume.value}__dance_${state.dance.value}__aaron_${state.aaron.value}__partner_${state.partner.value}__${additionals}`
	YOUTUBE_LINKS[targetVid] ? submitButton.classList.remove('error') : submitButton.classList.add('error')
}

function sumCredits() {
	let additionalCredits;
	if (state.story.value === "confession") {
		additionalCredits = state.confession_script.credits;
	} else {
		additionalCredits = state.prop_chocolate.credits + state.prop_champagne.credits;
	}
	return state.aaron.credits + state.partner.credits + state.volume.credits + state.dance.credits + additionalCredits;
}

function resizeHandler(){
	let ws = window.innerWidth / 1920;
	let hs = window.innerHeight / 1080;
	let screensize = ws < hs ? ws : hs;
	fontSize = 100 * screensize;
	webpage.setAttribute('style', `font-size: ${fontSize}px`)
	let isPhone = navigator.userAgent.toLowerCase()
	if (isPhone.includes('iphone') || isPhone.includes('android')){
		webpage.classList.add('phone')
	} else {
		webpage.classList.remove('phone')
	}
}